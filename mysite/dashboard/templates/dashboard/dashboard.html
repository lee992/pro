<!-- dashboard.html -->
{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ëŒ€ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">

    <!-- ê·¸ë˜í”„ë¥¼ ê·¸ë¦¬ê¸° ìœ„í•œ Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- í­ì£½ íš¨ê³¼ë¥¼ ìœ„í•œ canvas-confetti ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
</head>
<body>
    <!-- ì‚¬ì´ë“œë°” í† ê¸€ ë²„íŠ¼ -->
    <button id="sidebar-toggle" class="sidebar-toggle">
        <div class="hamburger-icon">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </button>
    <!-- ì‚¬ì´ë“œë°”: ì£¼ëœ ë„¤ë¹„ê²Œì´ì…˜ ì˜ì—­ì…ë‹ˆë‹¤. -->
    <div class="sidebar">
        <div class="logo">Y.B.<span>DashBoard</span></div>
        <ul>
            <li><a href="#" class="active" data-target="home-content">ëŒ€ì‹œë³´ë“œ</a></li>
            <li><a href="#" data-target="user-central-content">ì‚¬ìš©ì ê´€ë¦¬</a></li>
            <li><a href="#" data-target="admin-content">ê´€ë¦¬ì</a></li>
            <li><a href="#" data-target="settings-content">ì„¤ì •</a></li>
            <li><a href="#">ì§€ì›</a></li> <!-- íŠ¹ë³„ ë™ì‘ ë§í¬ -->
            {% load i18n %}
            <li class="nav-item">
            {% if user.is_authenticated %}
                {# ë¡œê·¸ì¸ì´ ë˜ì–´ìˆìœ¼ë©´ 'ë¡œê·¸ì•„ì›ƒ' ë²„íŠ¼ í‘œì‹œ (POST ë°©ì‹) #}
                
                <!-- ë¡œê·¸ì•„ì›ƒ ìš”ì²­ì„ ë³´ë‚¼ ìˆ¨ê²¨ì§„ í¼ -->
                <form id="logout-form" method="post" action="{% url 'dashboard:logout' %}" style="display: none;">
                    {% csrf_token %}
                </form>
        
                <!-- í´ë¦­ ì‹œ ìœ„ í¼ì„ ì œì¶œí•˜ëŠ” ë§í¬ -->
                <a class="nav-link" href="#" onclick="event.preventDefault(); document.getElementById('logout-form').submit();">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>{% translate 'Log out' %}</span>
                </a>
        
            {% else %}
                {# ë¡œê·¸ì¸ì´ ì•ˆ ë˜ì–´ìˆìœ¼ë©´ 'ë¡œê·¸ì¸' ë²„íŠ¼ í‘œì‹œ #}
                <a class="nav-link" href="{% url 'dashboard:login' %}?next={{ request.path }}">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>{% translate 'Log in' %}</span>
                </a>
            {% endif %}
        </li>
        </ul>
        <div class="sidebar-footer">
            <div class="theme-switch-wrapper">
                <span class="theme-label">ë‹¤í¬ ëª¨ë“œ</span>
                <label class="theme-switch" for="theme-toggle">
                    <input type="checkbox" id="theme-toggle" />
                    <span class="slider"></span>
                </label>
            </div>
            <div class="support">
                <h4>ì˜¤ëŠ˜ë„ í™”ì´íŒ…!</h4>
                <p style="margin: 0 0 12px; font-size: 0.8rem;">ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”</p>
                <button id="celebrate-btn">ì—…ë¬´ ì‹œì‘!</button>
            </div>
        </div>  
    </div>

    <!-- ë©”ì¸ ì½˜í…ì¸ : ì‚¬ì´ë“œë°” ì˜†ì— ìœ„ì¹˜í•˜ëŠ” ì‹¤ì œ ëŒ€ì‹œë³´ë“œ ì˜ì—­ì…ë‹ˆë‹¤. -->
    <div class="main-content">
        <!-- ìƒë‹¨ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="top-nav">
            <a href="#" class="active">HR</a>
            <a href="#">FS</a>
            <a href="#">CS</a>
        </div>

        <!-- User Central í˜ì´ì§€ ì½˜í…ì¸  (Placeholder) -->
        <div id="user-central-content" class="page-content">
            <div class="data-table-container">
                <h2>ì „ì²´ ì‚¬ìš©ì ëª©ë¡</h2>
                <div class="table-toolbar">
                    <input type="text" id="user-search-input" placeholder="ì‚¬ìš©ìëª…, ì´ë©”ì¼, ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰...">
                </div>
                <div id="user-list-wrapper" data-ajax-url="{% url 'dashboard:user_list_partial' %}">
                    {% include 'dashboard/_user_list.html' %}
                </div>
            </div>
        </div>

        <!-- í™ˆ ì½˜í…ì¸  (ê¸°ì¡´ Homeê³¼ Dashboard ë³‘í•©) -->
        <div id="home-content" class="page-content active">
            <!-- ì„œë¹„ìŠ¤ í˜„í™© ëŒ€ì‹œë³´ë“œ -->
            <div class="dashboard-container">
                <!-- ëŒ€ì‹œë³´ë“œ í—¤ë” -->
                <div class="dashboard-header">
                    <h1>ì„œë¹„ìŠ¤ í˜„í™© ëŒ€ì‹œë³´ë“œ</h1>
                </div>

                <!-- ìš”ì•½ ì¹´ë“œ ì„¹ì…˜ -->
                <div class="summary-grid">
                    <div class="card card-users">
                        <h3>ì´ ì‚¬ìš©ì</h3>
                        <p class="count">{{ user_count }}</p>
                    </div>
                    <div class="card card-posts">
                        <h3>ì´ ê²Œì‹œê¸€</h3>
                        <p class="count">{{ post_count }}</p>
                    </div>
                    <div class="card card-comments">
                        <h3>ì´ ëŒ“ê¸€</h3>
                        <p class="count">{{ comment_count }}</p>
                    </div>
                    <div class="card card-likes">
                        <h3>ì´ ì¢‹ì•„ìš”</h3>
                        <p class="count">{{ like_count }}</p>
                    </div>
                    <div class="card card-bookmarks">
                        <h3>ì´ ë¶ë§ˆí¬</h3>
                        <p class="count">{{ bookmark_count }}</p>
                    </div>
                    <div class="card card-mau">
                        <h3>ì›”ê°„ í™œì„± ì‚¬ìš©ì(MAU)</h3>
                        <p class="count">{{ mau_count }}</p>
                    </div>
                </div>

                <!-- ì°¨íŠ¸ ì„¹ì…˜ -->
                <div class="charts-grid">
                    <!-- ì›”ê°„ í™œì„± ì‚¬ìš©ì ê·¸ë˜í”„: ë¼ì¸ ê·¸ë˜í”„ë¡œ í‘œí˜„ -->
                    <div class="chart-container line-chart">
                        <h2>ì›”ê°„ í™œì„± ì‚¬ìš©ì (ìµœê·¼ 12ê°œì›”)</h2>
                        <div class="chart-wrapper">
                            <canvas id="mauChart"
                                    data-labels='{{ mau_chart_labels|safe }}'
                                    data-values='{{ mau_chart_values|safe }}'>
                            </canvas>
                        </div>
                    </div>
                    <!-- ì „ì²´ ì½˜í…ì¸  ë¶„í¬ ë„ë„› ê·¸ë˜í”„ -->
                    <div class="chart-container pie-chart">
                        <h2>ì „ì²´ ì½˜í…ì¸  ë¶„í¬</h2>
                        <div class="chart-wrapper">
                            <canvas id="contentPieChart"
                                    data-labels='{{ content_distribution_labels|safe }}'
                                    data-values='{{ content_distribution_values|safe }}'></canvas>
                        </div>
                    </div>
                </div>

                <!-- ìµœê·¼ ê°€ì…ì ë° ê²Œì‹œê¸€ ëª©ë¡ -->
                <div class="details-grid">
                    <div class="list-card">
                        <h3>ìµœê·¼ ê°€ì…ì</h3>
                        <ul>
                            {% for user in recent_users %}
                                <li>
                                    <span class="item-title">{{ user.username }}</span>
                                    <span class="item-meta">{{ user.date_joined|date:"Y-m-d" }}</span>
                                </li>
                            {% empty %}
                                <li>ê°€ì…í•œ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="list-card">
                        <h3>ìµœê·¼ ê²Œì‹œê¸€</h3>
                        <ul>
                            {% for post in recent_posts %}
                                <li>
                                    <span class="item-title">{{ post.title }}</span>
                                    <span class="item-meta">{{ post.author.username }} - {{ post.created_at|date:"Y-m-d" }}</span>
                                </li>
                            {% empty %}
                                <li>ì‘ì„±ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div><!-- end dashboard-container -->
        </div>

        <!-- Admin í˜ì´ì§€ ì½˜í…ì¸  (Placeholder) -->
        <div id="admin-content" class="page-content">
            <iframe src="/admin/" class="admin-iframe" title="Django Admin"></iframe>
        </div>

        <!-- Settings í˜ì´ì§€ ì½˜í…ì¸  (Placeholder) -->
        <div id="settings-content" class="page-content">
            <div class="settings-container">
                <h2>ì„¤ì •</h2>
                <div class="setting-section">
                    <h3>í”„ë¡œí•„ ì •ë³´</h3>
                    <form onsubmit="return false;">
                        <div class="form-group">
                            <label for="username">ì‚¬ìš©ìëª…</label>
                            <input type="text" id="username" value="{{ request.user.username }}" disabled>
                        </div>
                        <div class="form-group">
                            <label for="email">ì´ë©”ì¼ ì£¼ì†Œ</label>
                            <input type="email" id="email" value="{{ request.user.email|default_if_none:'' }}" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
                        </div>
                        <button type="button" class="btn-setting-action" onclick="alert('í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.')">í”„ë¡œí•„ ì—…ë°ì´íŠ¸</button>
                        <button type="button" class="btn-setting-action" onclick="alert('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.')">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
                    </form>
                </div>
                <div class="setting-section">
                    <h3>ëŒ€ì‹œë³´ë“œ í™˜ê²½ì„¤ì •</h3>
                    <div class="setting-item">
                        <span>ìƒˆ ì‚¬ìš©ì ê°€ì… ì‹œ ì´ë©”ì¼ ì•Œë¦¼ ë°›ê¸°</span>
                        <label class="theme-switch"><input type="checkbox" checked><span class="slider"></span></label>
                    </div>
                    <div class="setting-item">
                        <span>ì¼ì¼ ë¦¬í¬íŠ¸ ìë™ ìƒì„±</span>
                        <label class="theme-switch"><input type="checkbox"><span class="slider"></span></label>
                    </div>
                </div>
            </div>
        </div>
    </div><!-- end main-content -->
    <script src="{% static 'js/dashboard.js' %}"></script>

    <script>
        // í­ì£½ì„ í„°ëœ¨ë¦¬ëŠ” í•¨ìˆ˜
        function launchConfetti() {
            // ë³„ê³¼ í•˜íŠ¸ í­ì£½ì„ ë¨¼ì € í„°ëœ¨ë¦½ë‹ˆë‹¤.
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 },
                shapes: ['â­', 'ğŸ’–'],
                scalar: 1.5 // ëª¨ì–‘ í¬ê¸°
            });

            // 0.25ì´ˆ ë’¤ì— ë™ë¬¼ ì¹œêµ¬ë“¤ì´ ê¹œì§ ë“±ì¥í•©ë‹ˆë‹¤.
            setTimeout(() => {
                const animalShapes = ['ğŸ¦', 'ğŸ¯', 'ğŸ»', 'ğŸ¶', 'ğŸ±'];
                confetti({
                    particleCount: 40,
                    spread: 80,
                    origin: { y: 0.6, x: Math.random() }, // ëœë¤í•œ x ìœ„ì¹˜ì—ì„œ ë°œì‚¬
                    shapes: animalShapes,
                    scalar: 2.5 // ë™ë¬¼ë“¤ì€ ë” í¬ê²Œ!
                });
            }, 250);
        }

        // í˜ì´ì§€ê°€ ë¡œë“œëœ í›„ 'ì—…ë¬´ ì‹œì‘!' ë²„íŠ¼ì— í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ì—°ê²°í•©ë‹ˆë‹¤.
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('celebrate-btn').addEventListener('click', launchConfetti);
        });
    </script>

</body>
</html>