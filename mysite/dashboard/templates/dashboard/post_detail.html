{% extends "dashboard/board_base.html" %}
{% load i18n %}

{% block title %}{{ post.title }}{% endblock %}

{% block content %}
<div class="post-detail">
    <div class="post-header">
        <span class="post-category">{{ post.category.name }}</span>
        <h1>{{ post.title }}</h1>
        <div class="post-meta">
            <span>작성자: {{ post.author.username }}</span> |
            <span>작성일: {{ post.created_at|date:"Y.m.d H:i" }}</span>
            {% if post.created_at != post.updated_at %}
                | <span>수정일: {{ post.updated_at|date:"Y.m.d H:i" }}</span>
            {% endif %}
        </div>
        <div class="post-actions">
            {% if request.user == post.author %}
            <a href="{% url 'dashboard:post_edit' pk=post.pk %}" class="btn btn-secondary">수정하기</a>
            {% endif %}
            {% if user.is_authenticated %}
            <button id="like-btn" class="btn btn-like {% if user_has_liked %}liked{% endif %}" data-post-id="{{ post.pk }}">
                <i class="{% if user_has_liked %}fas{% else %}far{% endif %} fa-heart"></i>
                <span class="like-count">{{ like_count }}</span>
            </button>
            {% endif %}
        </div>
    </div>
    <div class="post-content">
        {{ post.content|linebreaksbr }}
    </div>
</div>

<div class="comments-section">
    <h3>댓글 ({{ comments.count }})</h3>
    <div class="comment-list">
        {% for comment in comments %}
        <div class="comment-item">
            <p class="comment-content">{{ comment.content|linebreaksbr }}</p>
            <div class="comment-meta">
                <span>{{ comment.author.username }}</span> -
                <span>{{ comment.created_at|date:"Y.m.d H:i" }}</span>
            </div>
        </div>
        {% empty %}
        <p>아직 댓글이 없습니다.</p>
        {% endfor %}
    </div>

    <form method="post" class="comment-form">
        {% csrf_token %}
        {{ comment_form.content }}
        {% if comment_form.content.errors %}
            <div class="field-error" style="margin-top: 5px;">
                {% for error in comment_form.content.errors %}
                    {{ error }}
                {% endfor %}
            </div>
        {% endif %}
        <button type="submit" class="btn btn-primary">댓글 작성</button>
    </form>
</div>
{% endblock %}